# ğŸŒ WebSocket å®Œæ•´é…ç½®æŒ‡å—

**ç›®æ ‡**: é…ç½® ETH + BSC åŒé“¾ WebSocket å®æ—¶ç›‘å¬

---

## âœ… å·²å®Œæˆ

- [x] åˆ›å»º `config.py` é…ç½®æ–‡ä»¶æ¨¡æ¿
- [x] Web3.py ç‰ˆæœ¬æ£€æŸ¥ (v7.14.0 âœ…)
- [x] åˆ›å»º WebSocket æµ‹è¯•è„šæœ¬

---

## ğŸ“‹ å¾…å®Œæˆæ­¥éª¤

### æ­¥éª¤ 1: æ³¨å†Œ Infura è´¦å·ï¼ˆEthereumï¼‰

1. è®¿é—® https://infura.io/
2. ç‚¹å‡» "Sign Up" æ³¨å†Œè´¦å·
3. ç™»å½•åï¼Œç‚¹å‡» "Create New Key"
4. é€‰æ‹©ç½‘ç»œ: **Ethereum** â†’ **Mainnet**
5. å¤åˆ¶ **Project ID** (è¿™å°±æ˜¯æ‚¨çš„ API Key)

**è·å–çš„ URLs**:
```
HTTP RPC:  https://mainnet.infura.io/v3/YOUR_PROJECT_ID
WebSocket: wss://mainnet.infura.io/ws/v3/YOUR_PROJECT_ID
```

---

### æ­¥éª¤ 2: æ³¨å†Œ Ankr è´¦å·ï¼ˆBSCï¼‰

1. è®¿é—® https://www.ankr.com/rpc/
2. ç‚¹å‡» "Get Started for Free" æ³¨å†Œè´¦å·
3. ç™»å½•åï¼Œè¿›å…¥ **Dashboard**
4. ç‚¹å‡» "Create Endpoint"
5. é€‰æ‹©é“¾: **BNB Smart Chain (BSC)**
6. é€‰æ‹©ç½‘ç»œ: **Mainnet**
7. å¤åˆ¶ç”Ÿæˆçš„ **WebSocket URL**

**è·å–çš„ URLs**:
```
HTTP RPC:  https://rpc.ankr.com/bsc/YOUR_API_KEY
WebSocket: wss://rpc.ankr.com/bsc/ws/YOUR_API_KEY
```

---

### æ­¥éª¤ 3: ç¼–è¾‘ config.py

æ‰“å¼€ [config.py](config.py)ï¼Œæ›¿æ¢ä»¥ä¸‹å ä½ç¬¦:

```python
# æ›¿æ¢ Infura API Key (ç¬¬ 26ã€29 è¡Œ)
ETH_CONFIG = {
    'rpc_url': 'https://mainnet.infura.io/v3/YOUR_INFURA_API_KEY',  # â† æ›¿æ¢è¿™é‡Œ
    'ws_url': 'wss://mainnet.infura.io/ws/v3/YOUR_INFURA_API_KEY',   # â† æ›¿æ¢è¿™é‡Œ
    'poll_interval': 12,
}

# æ›¿æ¢ Ankr API Key (ç¬¬ 40ã€43 è¡Œ)
BSC_CONFIG = {
    'rpc_url': 'https://rpc.ankr.com/bsc/YOUR_ANKR_API_KEY',        # â† æ›¿æ¢è¿™é‡Œ
    'ws_url': 'wss://rpc.ankr.com/bsc/ws/YOUR_ANKR_API_KEY',         # â† æ›¿æ¢è¿™é‡Œ
    'poll_interval': 3,
}
```

**ç¼–è¾‘å‘½ä»¤**:
```bash
vim config.py
# æˆ–
nano config.py
# æˆ–ä½¿ç”¨ VSCode
code config.py
```

---

### æ­¥éª¤ 4: æµ‹è¯• WebSocket è¿æ¥

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯é…ç½®:

```bash
python3 test_websocket.py
```

**é¢„æœŸè¾“å‡º**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                    WebSocket è¿æ¥æµ‹è¯•                                       â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

================================================================================
æµ‹è¯• Ethereum WebSocket è¿æ¥
================================================================================
URL: wss://mainnet.infura.io/ws/v3/YOUR_API_KEY
â³ æ­£åœ¨è¿æ¥...
âœ… WebSocket è¿æ¥æˆåŠŸï¼
â³ æµ‹è¯•åŒºå—æŸ¥è¯¢...
âœ… å½“å‰åŒºå—é«˜åº¦: 18234567
âœ… é“¾ ID: 1 (Ethereum Mainnet)
âœ… Ethereum WebSocket æµ‹è¯•é€šè¿‡ï¼

================================================================================
æµ‹è¯• BSC WebSocket è¿æ¥
================================================================================
URL: wss://rpc.ankr.com/bsc/ws/YOUR_API_KEY
â³ æ­£åœ¨è¿æ¥...
âœ… WebSocket è¿æ¥æˆåŠŸï¼
â³ æµ‹è¯•åŒºå—æŸ¥è¯¢...
âœ… å½“å‰åŒºå—é«˜åº¦: 34567890
âœ… é“¾ ID: 56 (BSC Mainnet)
âœ… BSC WebSocket æµ‹è¯•é€šè¿‡ï¼

================================================================================
æµ‹è¯•ç»“æœæ€»ç»“
================================================================================
âœ… æ‰€æœ‰è¿æ¥æµ‹è¯•é€šè¿‡ï¼

ä¸‹ä¸€æ­¥:
   è¿è¡Œç›‘å¬å™¨: python3 run_multichain.py
```

---

### æ­¥éª¤ 5: å¯åŠ¨ç›‘å¬å™¨

æµ‹è¯•é€šè¿‡åï¼Œå¯åŠ¨å®Œæ•´ç›‘å¬å™¨:

```bash
python3 run_multichain.py
```

**é¢„æœŸè¾“å‡º**:
```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      å¤šé“¾ç›‘å¬å¯åŠ¨ï¼ˆETH + BSC + å¯é€‰ Solanaï¼‰              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

================================================================================
ğŸ”„ [Ethereum] å¯åŠ¨ WebSocket ç›‘å¬
================================================================================
ç›‘æ§é’±åŒ…: 8 ä¸ª
================================================================================

âœ… [Ethereum] å·²è®¢é˜…é’±åŒ… 0x28C6c0...21d60 çš„ Transfer äº‹ä»¶
âœ… [Ethereum] å·²è®¢é˜…é’±åŒ… 0x21a31E...41aceC çš„ Transfer äº‹ä»¶
...
âœ… [Ethereum] WebSocket è¿æ¥æˆåŠŸï¼Œä½¿ç”¨ Web3.py v7+ æ–°ç‰ˆ API  â† æ–°ç‰ˆ APIï¼Œæ— è­¦å‘Š

================================================================================
ğŸ”„ [BSC] å¯åŠ¨ WebSocket ç›‘å¬
================================================================================
ç›‘æ§é’±åŒ…: 4 ä¸ª
================================================================================

âœ… [BSC] å·²è®¢é˜…é’±åŒ… 0x8894E0...2D4E3 çš„ Transfer äº‹ä»¶
âœ… [BSC] å·²è®¢é˜…é’±åŒ… 0x28C6c0...21d60 çš„ Transfer äº‹ä»¶
...
âœ… [BSC] WebSocket è¿æ¥æˆåŠŸï¼Œä½¿ç”¨ Web3.py v7+ æ–°ç‰ˆ API  â† æ–°ç‰ˆ APIï¼Œæ— è­¦å‘Š

âœ… å·²è·³è¿‡ Solanaï¼Œåªç›‘å¬ ETH + BSC

ğŸ” å®æ—¶ç›‘å¬ä¸­...
```

---

## ğŸ‰ é…ç½®æˆåŠŸæ ‡å¿—

å¦‚æœçœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼Œè¯´æ˜ WebSocket é…ç½®æˆåŠŸ:

âœ… **æ— è­¦å‘Šä¿¡æ¯**:
- ~~âš ï¸ [Ethereum] ä½¿ç”¨æ—§ç‰ˆ subscribe API~~ (å·²æ¶ˆé™¤)
- ~~âš ï¸ [BSC] WebSocket ç›‘å¬å¤±è´¥~~ (å·²æ¶ˆé™¤)

âœ… **æ–°çš„æˆåŠŸæç¤º**:
- `âœ… [Ethereum] WebSocket è¿æ¥æˆåŠŸï¼Œä½¿ç”¨ Web3.py v7+ æ–°ç‰ˆ API`
- `âœ… [BSC] WebSocket è¿æ¥æˆåŠŸï¼Œä½¿ç”¨ Web3.py v7+ æ–°ç‰ˆ API`

âœ… **å®æ—¶æ€§**:
- Ethereum: < 1 ç§’å»¶è¿Ÿï¼ˆWebSocket å®æ—¶æ¨é€ï¼‰
- BSC: < 1 ç§’å»¶è¿Ÿï¼ˆWebSocket å®æ—¶æ¨é€ï¼‰

---

## ğŸ”§ å¸¸è§é—®é¢˜

### Q1: æµ‹è¯•æ—¶æç¤º "API Key æœªé…ç½®"

**é—®é¢˜**:
```
âš ï¸  Ethereum WebSocket URL æœªé…ç½®æˆ–åŒ…å«å ä½ç¬¦
   è¯·ç¼–è¾‘ config.pyï¼Œæ›¿æ¢ YOUR_API_KEY
```

**è§£å†³**:
- æ£€æŸ¥ `config.py` æ˜¯å¦å·²æ›¿æ¢ `YOUR_INFURA_API_KEY`
- ç¡®è®¤ API Key æ²¡æœ‰å¤šä½™çš„ç©ºæ ¼æˆ–å¼•å·

---

### Q2: è¿æ¥å¤±è´¥æç¤º "401 Unauthorized"

**é—®é¢˜**:
```
âŒ Ethereum WebSocket è¿æ¥å¤±è´¥: 401 Unauthorized
```

**è§£å†³**:
- API Key é”™è¯¯ï¼Œæ£€æŸ¥æ˜¯å¦å¤åˆ¶æ­£ç¡®
- Infura: ç¡®è®¤ä½¿ç”¨çš„æ˜¯ **Project ID**ï¼Œä¸æ˜¯ API Secret
- Ankr: ç¡®è®¤ API Key å·²æ¿€æ´»

---

### Q3: éœ€è¦ä»£ç†æ‰èƒ½è¿æ¥

**é—®é¢˜**:
å›½å†…ç½‘ç»œå¯èƒ½æ— æ³•ç›´æ¥è®¿é—® Infura

**è§£å†³**:
1. ç¡®è®¤ `config.py` ä¸­ä»£ç†å·²é…ç½®:
   ```python
   PROXY = '127.0.0.1:7897'  # æ‚¨çš„ä»£ç†åœ°å€
   ```
2. ç¡®è®¤ä»£ç†æ­£åœ¨è¿è¡Œ
3. Ankr é€šå¸¸ä¸éœ€è¦ä»£ç†ï¼ˆå›½å†…å¯è®¿é—®ï¼‰

---

### Q4: ä»ç„¶çœ‹åˆ° "v6 å…¼å®¹æ¨¡å¼" æç¤º

**é—®é¢˜**:
```
â„¹ï¸  [Ethereum] WebSocket ä½¿ç”¨ Web3.py v6 å…¼å®¹æ¨¡å¼
```

**åŸå› **:
ç³»ç»Ÿè‡ªåŠ¨ä½¿ç”¨ v6 å…¼å®¹æ¨¡å¼ï¼ˆåŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼‰

**è§£å†³ï¼ˆå¯é€‰ï¼‰**:
å‡çº§ Web3.py:
```bash
pip install --upgrade web3>=7.7.0
```

---

## ğŸ“Š æ€§èƒ½å¯¹æ¯”

| æ¨¡å¼ | ETH å»¶è¿Ÿ | BSC å»¶è¿Ÿ | é…ç½®éš¾åº¦ | ç¨³å®šæ€§ |
|------|---------|---------|---------|--------|
| **HTTP è½®è¯¢** | 12 ç§’ | 3 ç§’ | â­ ç®€å• | â­â­â­â­â­ |
| **WebSocket** | < 1 ç§’ | < 1 ç§’ | â­â­â­ ä¸­ç­‰ | â­â­â­â­ |

**ç»“è®º**: å¦‚æœè¿½æ±‚**æœ€å¿«æ£€æµ‹é€Ÿåº¦**ï¼Œæ¨è WebSocketï¼›å¦‚æœè¿½æ±‚**ç¨³å®šæ€§**ï¼ŒHTTP è½®è¯¢å·²ç»è¶³å¤Ÿã€‚

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- Infura æ–‡æ¡£: https://docs.infura.io/
- Ankr æ–‡æ¡£: https://www.ankr.com/docs/
- Web3.py æ–‡æ¡£: https://web3py.readthedocs.io/

---

## âœ… é…ç½®æ£€æŸ¥æ¸…å•

- [ ] æ³¨å†Œ Infura è´¦å·å¹¶è·å– API Key
- [ ] æ³¨å†Œ Ankr è´¦å·å¹¶è·å– API Key
- [ ] ç¼–è¾‘ `config.py`ï¼Œæ›¿æ¢æ‰€æœ‰ `YOUR_*_API_KEY`
- [ ] è¿è¡Œ `python3 test_websocket.py` æµ‹è¯•è¿æ¥
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
- [ ] è¿è¡Œ `python3 run_multichain.py` å¯åŠ¨ç›‘å¬
- [ ] çœ‹åˆ° "WebSocket è¿æ¥æˆåŠŸ" æç¤º
- [ ] æ— è­¦å‘Šä¿¡æ¯

---

**æœ€åæ›´æ–°**: 2024-11-23
**ç»´æŠ¤è€…**: Claude Code AI
