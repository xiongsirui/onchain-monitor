# 📊 告警内容区分说明

**更新日期**: 2024-11-23
**版本**: v3.2

---

## 🎯 三种告警触发原因

系统现在会根据**不同的触发条件**显示不同的告警内容，帮助您快速判断代币类型和采取相应行动。

### 触发原因类型

| 触发原因 | 标识符 | 触发条件 | 告警级别 |
|---------|--------|---------|---------|
| **大额单笔转账** | `large_single` | 置信度 ≥ 80% + 单笔 ≥ 10万代币 | HIGH |
| **多笔转账+多发送者** | `multi_transfer` | 置信度 ≥ 80% + 转账 ≥ 3 + 发送者 ≥ 2 | HIGH |
| **中等置信度** | `medium_confidence` | 置信度 ≥ 60% + 转账 ≥ 5 | MEDIUM |

---

## 📋 告警内容对比

### 场景 1: 大额单笔转账（项目方打新）🆕

**典型特征**:
- 单笔或少量转账
- 转账金额巨大（≥ 10万代币）
- 通常来自项目方钱包

**控制台输出**:
```
🚨🚨🚨 [BSC] HIGH 级别告警! 🚨🚨🚨
   触发原因: 💰 大额单笔转账（疑似项目方打新）
   代币: NEWCOIN (New Coin Token)
   合约: 0x1234567890abcdef1234567890abcdef12345678
   转账数: 1 笔
   发送者: 1 个
   置信度: 100%
   🟢 强烈建议: 高置信度信号，多维度验证通过，建议重点关注
   💡 建议：重点关注！大额转账通常是项目方入库，可能即将上线
```

**飞书卡片内容**:
```
┌─────────────────────────────────────────┐
│ 🚨🚨🚨 [BSC] HIGH 级别新代币告警         │ ← 红色标题
├─────────────────────────────────────────┤
│ 代币符号: NEWCOIN                        │
│ 代币名称: New Coin Token                 │
│ 合约地址: 0x1234567890...                │
├─────────────────────────────────────────┤
│ 🎯 触发原因                              │
│ 💰 大额单笔转账（疑似项目方打新）        │ ← 重点标识
├─────────────────────────────────────────┤
│ 转账笔数: 1 笔                           │
│ 发送者数: 1 个                           │
│ 置信度评分: 100% ██████████             │
│ 风险等级: 🟢 低风险                      │
└─────────────────────────────────────────┘
```

**行动建议**:
> 💡 **重点关注！大额转账通常是项目方入库，可能即将上线**

---

### 场景 2: 多笔转账+多发送者（用户自然充值）

**典型特征**:
- 多笔转账（≥ 3 笔）
- 多个独立发送者（≥ 2 个）
- 金额分散，来自不同钱包

**控制台输出**:
```
🚨🚨🚨 [BSC] HIGH 级别告警! 🚨🚨🚨
   触发原因: 📊 多笔转账+多发送者模式
   代币: GOODCOIN (Good Coin)
   合约: 0xabcdef1234567890abcdef1234567890abcdef12
   转账数: 5 笔
   发送者: 3 个
   置信度: 100%
   🟢 强烈建议: 高置信度信号，多维度验证通过，建议重点关注
   💡 建议：检查多个发送者地址关联性，确认是否为真实用户
```

**飞书卡片内容**:
```
┌─────────────────────────────────────────┐
│ 🚨🚨🚨 [BSC] HIGH 级别新代币告警         │ ← 红色标题
├─────────────────────────────────────────┤
│ 代币符号: GOODCOIN                       │
│ 代币名称: Good Coin                      │
│ 合约地址: 0xabcdef1234...                │
├─────────────────────────────────────────┤
│ 🎯 触发原因                              │
│ 📊 多笔转账+多发送者模式                 │ ← 多用户标识
├─────────────────────────────────────────┤
│ 转账笔数: 5 笔                           │
│ 发送者数: 3 个                           │
│ 置信度评分: 100% ██████████             │
│ 风险等级: 🟢 低风险                      │
└─────────────────────────────────────────┘
```

**行动建议**:
> 💡 **检查多个发送者地址关联性，确认是否为真实用户**

---

### 场景 3: 中等置信度（疑似女巫攻击）

**典型特征**:
- 转账数量较多（≥ 5 笔）
- 置信度中等（60%-80%）
- 可能存在可疑模式

**控制台输出**:
```
⚡ [BSC] MEDIUM 级别告警! ⚡
   触发原因: ⚠️  中等置信度信号
   代币: SUSPECTCOIN (Suspect Coin)
   合约: 0x9876543210fedcba9876543210fedcba98765432
   转账数: 6 笔
   发送者: 5 个
   置信度: 68%
   🟡 谨慎建议: 中等置信度，建议持续观察，等待更多信号
   💡 建议：持续观察，等待更多转账数据验证
```

**飞书卡片内容**:
```
┌─────────────────────────────────────────┐
│ ⚡ [BSC] MEDIUM 级别新代币告警            │ ← 橙色标题
├─────────────────────────────────────────┤
│ 代币符号: SUSPECTCOIN                    │
│ 代币名称: Suspect Coin                   │
│ 合约地址: 0x9876543210...                │
├─────────────────────────────────────────┤
│ 🎯 触发原因                              │
│ ⚠️  中等置信度信号                       │ ← 警示标识
├─────────────────────────────────────────┤
│ 转账笔数: 6 笔                           │
│ 发送者数: 5 个                           │
│ 置信度评分: 68% ██████▓▓▓▓               │
│ 风险等级: 🟡 中等风险                    │
└─────────────────────────────────────────┘
```

**行动建议**:
> 💡 **持续观察，等待更多转账数据验证**

---

## 🔄 优先级匹配规则

当多个条件同时满足时，系统按以下优先级匹配触发原因：

1. **多笔转账+多发送者** (`multi_transfer`)
   - 条件: 置信度 ≥ 80% + 转账 ≥ 3 + 发送者 ≥ 2
   - 优先级: **最高**

2. **大额单笔转账** (`large_single`)
   - 条件: 置信度 ≥ 80% + 单笔 ≥ 10万代币
   - 优先级: **高**

3. **中等置信度** (`medium_confidence`)
   - 条件: 置信度 ≥ 60% + 转账 ≥ 5
   - 优先级: **中**

**示例**:
```python
# 场景: 项目方大额打新 + 用户充值混合
transfers = [
    {'from': '0xProject...', 'value': 2_000_000 * 10**18},  # 项目方 200万
    {'from': '0xProject...', 'value': 1_500_000 * 10**18},  # 项目方 150万
    {'from': '0xUserA...', 'value': 5_000 * 10**18},        # 用户 5千
]
发送者 = 2 个 (项目方 + 用户A)

# 匹配结果:
触发原因 = 📊 多笔转账+多发送者模式
# 因为: 转账 ≥ 3 + 发送者 ≥ 2 (优先级最高)
```

---

## 📊 实战对比

### 对比表格

| 场景 | 转账数 | 发送者 | 金额特征 | 触发原因 | 行动建议 |
|------|-------|--------|---------|---------|---------|
| 项目方单笔打新 | 1 | 1 | 500万 | 💰 大额单笔 | 重点关注，可能即将上线 |
| 项目方多笔打新 | 2-3 | 1 | 每笔100万+ | 💰 大额单笔 | 重点关注，可能即将上线 |
| 用户自然充值 | 3+ | 2+ | 分散 | 📊 多笔+多发送者 | 检查地址关联性 |
| 项目方+用户混合 | 3+ | 2+ | 混合 | 📊 多笔+多发送者 | 检查地址关联性 |
| 疑似女巫攻击 | 5+ | 5+ | 小额相似 | ⚠️  中等置信度 | 持续观察验证 |

---

## 🛠️ 技术实现

### 代码位置

1. **触发原因判断**: [multichain_listener.py:514-532](../multichain_listener.py#L514-L532)
2. **控制台告警输出**: [multichain_listener.py:553-598](../multichain_listener.py#L553-L598)
3. **飞书卡片构造**: [feishu_notifier.py:103-110](../feishu_notifier.py#L103-L110)

### 数据流

```
告警触发
    ↓
判断触发原因 (multi_transfer / large_single / medium_confidence)
    ↓
保存到 buffer['trigger_reason']
    ↓
    ┌─────────────┬─────────────┐
    │             │             │
控制台输出      飞书通知      其他通知
(显示触发原因)  (卡片显示)    (可扩展)
```

---

## 🧪 测试验证

运行测试脚本验证不同场景的告警区分：

```bash
python3 test_alert_differentiation.py
```

**测试输出**:
```
场景1 (单笔大额) → 触发原因: 💰 大额单笔转账（疑似项目方打新）
场景2 (多发送者) → 触发原因: 📊 多笔转账+多发送者模式
场景3 (中等置信) → 触发原因: ⚠️  中等置信度信号
场景4 (混合) → 触发原因: 📊 多笔转账+多发送者模式
```

---

## 📚 相关文档

- 告警系统详解: [ALERT_SYSTEM.md](ALERT_SYSTEM.md)
- 检测逻辑详解: [DETECTION_LOGIC.md](DETECTION_LOGIC.md)
- 单笔转账修复: [CHANGELOG_v3.1.md](CHANGELOG_v3.1.md)

---

## 🔄 更新日志

### v3.2 (2024-11-23)
- ✅ 新增触发原因标识（`trigger_reason`）
- ✅ 控制台输出区分不同触发原因
- ✅ 飞书卡片显示触发原因
- ✅ 针对性行动建议

---

**最后更新**: 2024-11-23
**版本**: v3.2
**维护者**: Claude Code AI
